services:
  openclaw:
    image: ghcr.io/coollabsio/openclaw:latest
    container_name: openclaw
    ports:
      - "127.0.0.1:18790:8080"   # localhost only — nginx handles TLS externally
    environment:
      # AI provider — at least one required
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      # - OPENAI_API_KEY=${OPENAI_API_KEY}
      # - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}

      # Web UI — leave AUTH_PASSWORD unset for tailnet-only open access,
      # or set it for an additional HTTP basic auth layer
      # - AUTH_USERNAME=yourname
      # - AUTH_PASSWORD=${OPENCLAW_AUTH_PASSWORD}

      # Gateway API token (used by nginx token injection and API clients)
      - OPENCLAW_GATEWAY_TOKEN=${AKIRA_GATEWAY_TOKEN}

      # Telegram channel (optional)
      - TELEGRAM_BOT_TOKEN=${AKIRA_TELEGRAM_BOT_TOKEN}
      - TELEGRAM_DM_POLICY=allowlist
      - TELEGRAM_ALLOW_FROM=${AKIRA_TELEGRAM_CHAT_ID}
      - TELEGRAM_REACTION_LEVEL=minimal

      # Phone call skill env vars (optional, requires FreePBX relay)
      - FREEPBX_RELAY_URL=${FREEPBX_RELAY_URL}
      - FREEPBX_RELAY_TOKEN=${FREEPBX_RELAY_TOKEN}
      - OWNER_PHONE=${OWNER_PHONE}

      # Runtime apt packages installed on each container start
      - OPENCLAW_DOCKER_APT_PACKAGES=python3-pip

      # Browser sidecar connection (CDP)
      - BROWSER_CDP_URL=http://browser:9222
      - BROWSER_DEFAULT_PROFILE=openclaw
      - BROWSER_EVALUATE_ENABLED=true

    volumes:
      - openclaw-data:/data
    depends_on:
      - browser
    restart: unless-stopped

  browser:
    image: ghcr.io/coollabsio/openclaw-browser:latest
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=UTC
      - CHROME_CLI=--remote-debugging-port=9222
    volumes:
      - browser-data:/config
    shm_size: 2g
    restart: unless-stopped

volumes:
  openclaw-data:
  browser-data:
